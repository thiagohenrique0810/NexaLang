use std::db::Database;

fn main() -> i32 {
    let db_res = Database::open("test.db");
    
    match (db_res) {
        Ok(db) => {
            print("Database opened successfully");
            
            db.execute("CREATE TABLE IF NOT EXISTS users (id INTEGER, name TEXT);");
            db.execute("INSERT INTO users (id, name) VALUES (1, 'Thiago');");
            db.execute("INSERT INTO users (id, name) VALUES (2, 'Nexa');");
            
            print("Fetching users:");
            let stmt_res = db.prepare("SELECT id, name FROM users;");
            match (stmt_res) {
                Ok(stmt) => {
                    # SQLITE_ROW = 100
                    while (stmt.step() == 100) {
                        let id = stmt.get_int(0);
                        let name = stmt.get_string(1);
                        
                        print("User found:");
                        print(id);
                        print(name.as_ptr());
                    }
                    stmt.finalize();
                }
                Err(e) => {
                    print("Failed to prepare statement");
                }
            }
            
            db.close();
        }
        Err(err) => {
            print("Failed to open database");
        }
    }
    
    return 0;
}
